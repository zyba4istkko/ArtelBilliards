# Контекст продукта Artel Billiards

## Общее понимание проекта
Artel Billiards  это приложение для организации и управления бильярдными играми, реализованное как Telegram Mini App. Приложение позволяет создавать игровые сессии с различными типами игр, управлять игроками, вести счет, отслеживать события и анализировать статистику игр.

## Пользовательский путь

### 1. Авторизация и регистрация
- **Первый вход**:
  - Пользователь должен авторизоваться или зарегистрироваться в приложении
  - Доступны методы авторизации через Google Auth и Telegram
- **Создание профиля**:
  - После регистрации пользователь создает свой профиль
  - Указывает необходимую информацию (имя, никнейм и т.д.)

### 2. Управление друзьями
- **Добавление друзей**:
  - Поиск пользователей по имени/никнейму
  - Отправка запросов на добавление в друзья
  - Подтверждение входящих запросов
- **Список друзей**:
  - Просмотр списка друзей
  - Возможность удаления из друзей
  - Группировка друзей (например, по частоте игр)
- **Управление друзьями**:
  - Возможность блокировки пользователей
  - Просмотр статистики игр с конкретными друзьями

### 3. Создание игровой сессии
- **Начало работы**: Пользователь нажимает "начать игру", что инициирует процесс создания сессии
- **Настройка условий игры**:
  - Выбор типа игры (Американка, Московская пирамида, Колхоз)
  - Настройка условий очередности:
    1. "Всегда рандом" - случайный порядок игроков в каждой игре
    2. "Рандом без повторений" - случайный порядок без повторения последовательности
  - Настройка правил подсчета очков и их стоимости в зависимости от выбранного типа игры:
    - Для Американки и Московской: цена за игру
    - Для Колхоза: цена за каждый шар и стоимость очка
  - Определение, кто может редактировать ход игры
- **Запуск сессии**: Пользователь нажимает "Начать" для создания сессии

### 4. Управление игроками
- **Добавление игроков**: 
  - Организатор может добавить игроков в сессию:
    - Из списка друзей
    - Создать "пустых пользователей" для игроков без приложения
  - Система генерирует код сессии (например, "SD76SG")
  - Игроки с приложением могут присоединиться к игре, введя этот код
- **Пустые пользователи**:
  - Возможность создания временных профилей для игроков без приложения
  - Организатор может вести счет за этих игроков
  - Результаты сохраняются в статистике организатора
- **Приглашение игроков**:
  - Можно выбрать игроков из списка друзей
  - Можно добавить партнеров
  - Можно добавить теги для группировки игроков
  - Интеграция с Telegram для приглашения друзей (во второй версии)
- **Подтверждение участия**:
  - Приглашенные игроки получают доступ к сессии
  - Они могут подтвердить участие или отказаться

### 5. Проведение игры
- **Начало игры**:
  - Отображаются все участники (включая "пустых пользователей")
  - Показывается текущий счет игроков
  - Запускается таймер для отслеживания длительности игры
- **Ход игры**:
  - Организатор или авторизованные игроки могут добавлять события:
    - **Американка**: забитые шары (игра до 8 шаров)
    - **Московская**: забитые шары с указанием типа (свой/чужой), игра до 8 шаров
    - **Колхоз**: забитые шары с указанием цвета/типа и их стоимости
  - Система отслеживает события и начисляет очки согласно правилам выбранного типа игры
  - Логирование всех действий с указанием, кто добавил событие
  - Возможность добавления дополнительной информации о забитом шаре (например, "случайный шар")
  - Возможность добавления штрафов и фолов как отдельных событий
- **Завершение игры**:
  - Пользователь может завершить игру нажатием "Закончить игру"
  - Система подсчитывает итоговые результаты
  - Автоматический расчет денежных выигрышей/проигрышей
  - Обновление баланса игроков

### 6. Управление сессией
- **Продолжение сессии**:
  - После завершения игры можно начать следующую игру в рамках той же сессии
  - Нажатие "Начать следующую игру" создает новую игру с теми же игроками
- **Завершение сессии**:
  - Организатор может завершить всю сессию
  - Система подводит общие итоги по всем играм в сессии
  - Отображение итогового баланса каждого игрока

### 7. Статистика и история
- **Статистика игры**:
  - Детальная информация о текущей игре
  - События, очки, штрафы
  - Длительность игры
- **Статистика сессии**:
  - Сводная информация по всем играм в сессии
  - Итоговый баланс каждого игрока
- **Профили игроков**:
  - История игр и сессий
  - Статистика по результатам
  - Включая игры с "пустыми пользователями"
- **Лог событий**:
  - Возможность просмотра всех событий игры
  - Информация о том, кто добавил каждое событие
  - Детали о забитых шарах (тип, случайный/намеренный и т.д.)

### 8. Шаблоны игр
- **Базовые шаблоны**:
  - Предустановленные шаблоны для всех типов игр
  - Для Колхоза: стандартные наборы шаров с их стоимостью
- **Пользовательские шаблоны**:
  - Возможность создания собственных шаблонов
  - Настройка стоимости шаров для Колхоза
  - Сохранение шаблонов для повторного использования

## Типы игр и правила

### 1. Американка
- Игра ведется до 8 забитых шаров
- Формат: 1х1 или 2х2
- В начале сессии устанавливается цена за игру
- После окончания игры изменяется баланс игроков

### 2. Московская пирамида
- Игра ведется до 8 забитых шаров
- Формат: 1х1 или 2х2
- Игра ведется одним шаром
- Важно фиксировать тип забитого шара (свой/чужой)
- В начале сессии устанавливается цена за игру
- После окончания игры изменяется баланс игроков

### 3. Колхоз
- Используются шары разной стоимости
- Стоимость шаров и очков задается в шаблонах:
  - Базовые шаблоны: доступны всем
  - Пользовательские шаблоны: создаются игроками
- Примеры шаблонов:
  - Базовый: "Белый шар" - 1, "Желтый шар" - 2, "Розовый шар" - 3, стоимость очка - 50р
  - Пользовательский: "Белый шар" - 1, "Желтый шар" - 2, "Розовый шар" - 3, "Зеленый шар" - 6, стоимость очка - 500р

## Роли пользователей

### 1. Организатор
- Создает сессию
- Устанавливает правила
- Приглашает и удаляет игроков
- Создает "пустых пользователей" для игроков без приложения
- Завершает сессию
- Имеет полный доступ к управлению игрой

### 2. Игрок
- Присоединяется к сессии
- В зависимости от установленных организатором прав:
  - Может добавлять события
  - Может только просматривать ход игры
- Видит статистику и результаты

### 3. "Пустой пользователь"
- Временный профиль для игрока без приложения
- Не имеет доступа к приложению
- Все действия за него выполняет организатор
- Результаты сохраняются в статистике организатора

## Планы на вторую версию

1. **Система рейтинга игроков** - глобальный рейтинг между всеми пользователями
2. **Турниры** - возможность создания турниров с несколькими сессиями
3. **Уведомления через Telegram** - оповещения о приглашениях, результатах и т.д.
4. **Система достижений** - для повышения вовлеченности пользователей

## Следующие шаги по проектированию

1. Разработка архитектуры базы данных для хранения:
   - Информации о пользователях и друзьях
   - Сессиях и играх
   - Событиях и результатах
   - Шаблонах игр
   - "Пустых пользователях"

2. Проектирование API для взаимодействия между клиентом и сервером:
   - Эндпоинты для авторизации и управления профилем
   - Эндпоинты для управления друзьями
   - Эндпоинты для создания и управления сессиями
   - Эндпоинты для добавления событий
   - Эндпоинты для получения статистики

3. Проектирование компонентной структуры React-приложения:
   - Компоненты для авторизации и регистрации
   - Компоненты для управления друзьями
   - Компоненты для создания сессии
   - Компоненты для отображения игры
   - Компоненты для статистики

4. Разработка механизмов интеграции с Telegram Mini Apps
