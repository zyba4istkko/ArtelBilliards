FROM node:20-alpine

# Рабочая директория внутри контейнера
WORKDIR /app

# Устанавливаем системные зависимости
RUN apk add --no-cache curl libc6-compat

# Обновляем npm
RUN npm install -g npm@latest

# Копируем package files
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install --force

# Устанавливаем serve для production
RUN npm install -g serve

# Копируем исходники
COPY . .

# Собираем production версию
RUN npm run build-tunnel

# Открываем порт Vite
EXPOSE 5173

# Запускаем статический сервер для туннеля
CMD ["serve", "-s", "dist", "-l", "5173"] 