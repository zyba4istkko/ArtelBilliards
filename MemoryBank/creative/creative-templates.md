# üé®üé®üé® ENTERING CREATIVE PHASE: GAME TEMPLATES SYSTEM üé®üé®üé®

## –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∏–≥—Ä –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–∏–ª—å—è—Ä–¥–Ω—ã—Ö –∏–≥—Ä. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥–∏–±–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–∞–≤–∏–ª –¥–ª—è –∏–≥—Ä "–ê–º–µ—Ä–∏–∫–∞–Ω–∫–∞", "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞" –∏ "–ö–æ–ª—Ö–æ–∑" —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ç–∏–ø–æ–≤ –∏–≥—Ä —Å –∏—Ö —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–∑–æ–≤—ã—Ö
- –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è —É–¥–æ–±–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤
- –ü—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
- –°–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Template Service (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JSONB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª (PostgreSQL)
- API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ FastAPI
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic –º–æ–¥–µ–ª–∏

### –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑":
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –æ—á–∫–∞ –≤ —Ä—É–±–ª—è—Ö
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —à–∞—Ä–æ–≤
- –ü—Ä–∞–≤–∏–ª–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á–µ—Ç–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üé® CREATIVE CHECKPOINT: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω

## –ê–Ω–∞–ª–∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç—ã–µ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∏–≥—Ä –≤ –≤–∏–¥–µ –ø—Ä–æ—Å—Ç—ã—Ö JSON –æ–±—ä–µ–∫—Ç–æ–≤ –±–µ–∑ –∂–µ—Å—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

**–ü–ª—é—Å—ã**:
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø—Ä–∞–≤–∏–ª
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ë—ã—Å—Ç—Ä–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–Ω—É—Å—ã**:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –¢—Ä—É–¥–Ω–æ—Å—Ç–∏ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –†–∏—Å–∫ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –ù–∏–∑–∫–∞—è
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 2-3 –¥–Ω—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã —Å —Å—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Pydantic.

**–ü–ª—é—Å—ã**:
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –ø—Ä–∞–≤–∏–ª
- –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- –õ–µ–≥–∫–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ú–∏–Ω—É—Å—ã**:
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–∞–≤–∏–ª
- –ë–æ–ª—å—à–µ –∫–æ–¥–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –í–æ–∑–º–æ–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 5-7 –¥–Ω–µ–π

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ JSON –ø–æ–ª—è.

**–ü–ª—é—Å—ã**:
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –≥–∏–±–∫–æ—Å—Ç—å—é –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª —á–µ—Ä–µ–∑ —Ç–∏–ø–∏–∑–∞—Ü–∏—é
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–ª—É—á–∞–µ–≤
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª
- –•–æ—Ä–æ—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–ú–∏–Ω—É—Å—ã**:
- –°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: 4-5 –¥–Ω–µ–π

## –ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**–í—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (–í–∞—Ä–∏–∞–Ω—Ç 3)**

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Pydantic –º–æ–¥–µ–ª–∏
2. **–ì–∏–±–∫–æ—Å—Ç—å**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ JSON –ø–æ–ª—è
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë—ã—Å—Ç—Ä–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
5. **–£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: –ß–µ—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª

## –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤

### –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞

```python
# Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤

class BaseGameRules(BaseModel):
    """–ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–≥—Ä"""
    game_type: Literal["americana", "moscow_pyramid", "kolkhoz"]
    max_players: int = Field(ge=2, le=8)
    min_players: int = Field(ge=2, le=8)
    point_value_rubles: Decimal = Field(ge=0, le=10000)  # –°—Ç–æ–∏–º–æ—Å—Ç—å –æ—á–∫–∞ –≤ —Ä—É–±–ª—è—Ö
    time_limit_minutes: Optional[int] = Field(None, ge=5, le=180)
    
class BallConfig(BaseModel):
    """–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —à–∞—Ä–∞"""
    color: str
    points: int = Field(ge=1, le=10)
    is_required: bool = True  # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ª–∏ —à–∞—Ä –¥–ª—è –∏–≥—Ä—ã
    order_priority: int = 0   # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏

class KolkhozRules(BaseGameRules):
    """–°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–≥—Ä—ã –ö–æ–ª—Ö–æ–∑"""
    game_type: Literal["kolkhoz"] = "kolkhoz"
    balls: List[BallConfig]  # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞
    payment_direction: Literal["clockwise", "counter_clockwise"] = "clockwise"
    allow_queue_change: bool = True  # –ú–æ–∂–Ω–æ –ª–∏ –º–µ–Ω—è—Ç—å –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –∏–≥—Ä–∞–º–∏
    queue_algorithm: Literal["always_random", "random_no_repeat", "manual"] = "random_no_repeat"
    calculate_net_result: bool = True  # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —á–∏—Å—Ç—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ –ø–æ–ª—è
    advanced_settings: Dict[str, Any] = Field(default_factory=dict)

class AmericanaRules(BaseGameRules):
    """–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ê–º–µ—Ä–∏–∫–∞–Ω–∫–∏"""
    game_type: Literal["americana"] = "americana"
    balls_count: int = Field(15, ge=9, le=15)
    break_rules: Dict[str, Any] = Field(default_factory=dict)
    foul_penalties: Dict[str, int] = Field(default_factory=dict)
    
class MoscowPyramidRules(BaseGameRules):
    """–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –ø–∏—Ä–∞–º–∏–¥—ã"""
    game_type: Literal["moscow_pyramid"] = "moscow_pyramid"
    pyramid_type: Literal["dynamic", "combined", "free"] = "dynamic"
    balls_count: int = Field(15, ge=15, le=15)
    win_condition: Dict[str, Any] = Field(default_factory=dict)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —à–∞–±–ª–æ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏ –≤ game_templates –¥–ª—è –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑"
INSERT INTO game_templates (
    id, creator_user_id, game_type_id, name, description, rules, settings, is_public, is_system
) VALUES (
    gen_random_uuid(),
    'system-user-uuid',
    3, -- ID —Ç–∏–ø–∞ –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑"
    '–ö–æ–ª—Ö–æ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (50‚ÇΩ –∑–∞ –æ—á–∫–æ)',
    '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –ö–æ–ª—Ö–æ–∑ —Å –æ–ø–ª–∞—Ç–æ–π 50 —Ä—É–±–ª–µ–π –∑–∞ –æ—á–∫–æ',
    '{
        "game_type": "kolkhoz",
        "max_players": 6,
        "min_players": 2,
        "point_value_rubles": 50.00,
        "balls": [
            {"color": "white", "points": 1, "order_priority": 1},
            {"color": "yellow", "points": 2, "order_priority": 2},
            {"color": "green", "points": 3, "order_priority": 3},
            {"color": "brown", "points": 4, "order_priority": 4},
            {"color": "blue", "points": 5, "order_priority": 5},
            {"color": "pink", "points": 6, "order_priority": 6},
            {"color": "black", "points": 7, "order_priority": 7}
        ],
        "payment_direction": "clockwise",
        "allow_queue_change": true,
        "calculate_net_result": true
    }',
    '{
        "ui_theme": "classic",
        "show_running_total": true,
        "enable_sound_effects": true,
        "auto_calculate_results": true
    }',
    true,  -- –ü—É–±–ª–∏—á–Ω—ã–π —à–∞–±–ª–æ–Ω
    true   -- –°–∏—Å—Ç–µ–º–Ω—ã–π —à–∞–±–ª–æ–Ω
);
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤

```sql
-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤
INSERT INTO template_categories (name, description, sort_order) VALUES
('–ö–æ–ª—Ö–æ–∑', '–®–∞–±–ª–æ–Ω—ã –¥–ª—è –∏–≥—Ä—ã –ö–æ–ª—Ö–æ–∑', 1),
('–ê–º–µ—Ä–∏–∫–∞–Ω–∫–∞', '–®–∞–±–ª–æ–Ω—ã –¥–ª—è –ê–º–µ—Ä–∏–∫–∞–Ω–∫–∏', 2),
('–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞', '–®–∞–±–ª–æ–Ω—ã –¥–ª—è –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –ø–∏—Ä–∞–º–∏–¥—ã', 3),
('–¢—É—Ä–Ω–∏—Ä—ã', '–®–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–Ω—ã—Ö –∏–≥—Ä', 4),
('–û–±—É—á–µ–Ω–∏–µ', '–£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤', 5),
('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ', '–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏', 6);

-- –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–±—Ä–∞–Ω—ã –∫–∞–∫ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞
```

### –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑"

#### 1. –ë—é–¥–∂–µ—Ç–Ω—ã–π –ö–æ–ª—Ö–æ–∑ (25‚ÇΩ –∑–∞ –æ—á–∫–æ)
```json
{
    "name": "–ö–æ–ª—Ö–æ–∑ –±—é–¥–∂–µ—Ç–Ω—ã–π",
    "rules": {
        "game_type": "kolkhoz",
        "point_value_rubles": 25.00,
        "max_players": 4,
        "balls": [
            {"color": "white", "points": 1, "order_priority": 1},
            {"color": "yellow", "points": 2, "order_priority": 2},
            {"color": "green", "points": 3, "order_priority": 3},
            {"color": "pink", "points": 4, "order_priority": 4}
        ]
    }
}
```

#### 2. –ü—Ä–µ–º–∏—É–º –ö–æ–ª—Ö–æ–∑ (200‚ÇΩ –∑–∞ –æ—á–∫–æ)
```json
{
    "name": "–ö–æ–ª—Ö–æ–∑ –ø—Ä–µ–º–∏—É–º",
    "rules": {
        "game_type": "kolkhoz", 
        "point_value_rubles": 200.00,
        "max_players": 6,
        "time_limit_minutes": 30,
        "balls": [
            {"color": "white", "points": 1, "order_priority": 1},
            {"color": "yellow", "points": 2, "order_priority": 2},
            {"color": "green", "points": 3, "order_priority": 3},
            {"color": "brown", "points": 4, "order_priority": 4},
            {"color": "blue", "points": 5, "order_priority": 5},
            {"color": "pink", "points": 6, "order_priority": 6},
            {"color": "black", "points": 7, "order_priority": 7}
        ]
    },
    "settings": {
        "require_confirmation": true,
        "show_money_warnings": true
    }
}
```

#### 3. –ë—ã—Å—Ç—Ä—ã–π –ö–æ–ª—Ö–æ–∑ (15 –º–∏–Ω—É—Ç)
```json
{
    "name": "–ö–æ–ª—Ö–æ–∑ —ç–∫—Å–ø—Ä–µ—Å—Å",
    "rules": {
        "game_type": "kolkhoz",
        "point_value_rubles": 50.00,
        "time_limit_minutes": 15,
        "balls": [
            {"color": "white", "points": 1, "order_priority": 1},
            {"color": "yellow", "points": 2, "order_priority": 2},
            {"color": "pink", "points": 3, "order_priority": 3}
        ]
    }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û—á–∫–∏ –∑–∞ –∫–∞–∂–¥—ã–π —Ü–≤–µ—Ç —à–∞—Ä–∞ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞. –í —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å –ª—é–±—ã–º–∏ –æ—á–∫–∞–º–∏ –æ—Ç 1 –¥–æ 10.

### API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —à–∞–±–ª–æ–Ω–∞–º–∏

```python
# FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è Template Service

@router.get("/templates")
async def get_templates(
    game_type: Optional[str] = None,
    category_id: Optional[int] = None,
    is_public: bool = True,
    current_user: User = Depends(get_current_user)
):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤"""
    return await get_filtered_templates(
        game_type=game_type,
        category_id=category_id, 
        is_public=is_public,
        user_id=current_user.id
    )

@router.post("/templates")
async def create_template(
    template: GameTemplateCreate,
    current_user: User = Depends(get_current_user)
):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —à–∞–±–ª–æ–Ω"""
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª —á–µ—Ä–µ–∑ Pydantic
    if template.game_type == "kolkhoz":
        validated_rules = KolkhozRules(**template.rules)
    elif template.game_type == "americana":
        validated_rules = AmericanaRules(**template.rules)
    elif template.game_type == "moscow_pyramid":
        validated_rules = MoscowPyramidRules(**template.rules)
    
    return await create_game_template(
        creator_id=current_user.id,
        validated_rules=validated_rules.dict(),
        template_data=template
    )

@router.get("/templates/{template_id}")
async def get_template(template_id: UUID):
    """–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —à–∞–±–ª–æ–Ω–∞"""
    return await get_template_by_id(template_id)

@router.put("/templates/{template_id}")
async def update_template(
    template_id: UUID,
    template: GameTemplateUpdate,
    current_user: User = Depends(get_current_user)
):
    """–û–±–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å)"""
    return await update_game_template(template_id, template, current_user.id)

@router.post("/templates/{template_id}/favorite")
async def add_to_favorites(
    template_id: UUID,
    current_user: User = Depends(get_current_user)
):
    """–î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"""
    return await add_template_to_favorites(template_id, current_user.id)

@router.get("/templates/categories")
async def get_categories():
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —à–∞–±–ª–æ–Ω–æ–≤"""
    return await get_template_categories()
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

```python
class TemplateValidator:
    """–í–∞–ª–∏–¥–∞—Ç–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ –∏–≥—Ä"""
    
    @staticmethod
    def validate_kolkhoz_rules(rules: KolkhozRules) -> List[str]:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª –ö–æ–ª—Ö–æ–∑–∞"""
        errors = []
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —à–∞—Ä–æ–≤
        if len(rules.balls) < 2:
            errors.append("–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —à–∞—Ä–∞")
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ü–≤–µ—Ç–æ–≤
        colors = [ball.color for ball in rules.balls]
        if len(colors) != len(set(colors)):
            errors.append("–¶–≤–µ—Ç–∞ —à–∞—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏")
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—É–º–Ω–æ—Å—Ç–∏ —Å—Ç–∞–≤–æ–∫
        if rules.point_value_rubles > 10000:
            errors.append("–°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞—è —Å—Ç–∞–≤–∫–∞ (–±–æ–ª–µ–µ 10 000‚ÇΩ –∑–∞ –æ—á–∫–æ)")
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
        if rules.min_players > rules.max_players:
            errors.append("–ú–∏–Ω–∏–º—É–º –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –º–∞–∫—Å–∏–º—É–º–∞")
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∫–æ–≤ –∑–∞ —à–∞—Ä—ã
        for ball in rules.balls:
            if ball.points < 1 or ball.points > 10:
                errors.append(f"–û—á–∫–∏ –∑–∞ —à–∞—Ä {ball.color} –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 1 –¥–æ 10")
            
        return errors
    
    @staticmethod
    def validate_template_permissions(template: GameTemplate, user: User) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞"""
        if template.is_system:
            return user.is_admin  # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ
        return template.creator_user_id == user.id

## –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤

### –¢–∏–ø—ã –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏

#### 1. **Always Random** (–í—Å–µ–≥–¥–∞ —Ä–∞–Ω–¥–æ–º)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—É—é –Ω–æ–≤—É—é –∏–≥—Ä—É –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ.

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:
```python
import random

def generate_always_random_queue(participants: List[Participant]) -> List[Participant]:
    """–°–ª—É—á–∞–π–Ω–∞—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã"""
    shuffled = participants.copy()
    random.shuffle(shuffled)
    return shuffled

# –ü—Ä–∏–º–µ—Ä –¥–ª—è 3 –∏–≥—Ä–æ–∫–æ–≤ (–ò–≥—Ä–æ–∫ –ê, –ë, –í):
# –ò–≥—Ä–∞ 1: –ê ‚Üí –ë ‚Üí –í
# –ò–≥—Ä–∞ 2: –í ‚Üí –ê ‚Üí –ë  
# –ò–≥—Ä–∞ 3: –ê ‚Üí –í ‚Üí –ë
# –ò–≥—Ä–∞ 4: –ë ‚Üí –ê ‚Üí –í (–º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å—Å—è –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ—Ä—è–¥–æ–∫)
```

**–ü–ª—é—Å—ã**:
- –ü–æ–ª–Ω–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å

**–ú–∏–Ω—É—Å—ã**:
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ (–æ–¥–∏–Ω –∏–≥—Ä–æ–∫ —á–∞—Å—Ç–æ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º)
- –í–æ–∑–º–æ–∂–Ω—ã –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏
- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–π

#### 2. **Random No Repeat** (–†–∞–Ω–¥–æ–º –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤) - –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô

**–û–ø–∏—Å–∞–Ω–∏–µ**: –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ —Å —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∞—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π.

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:
```python
def generate_random_no_repeat_queue(
    participants: List[Participant], 
    previous_queues: List[List[Participant]],
    max_history: int = None  # –ë—É–¥–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
) -> List[Participant]:
    """–†–∞–Ω–¥–æ–º –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –Ω–µ–¥–∞–≤–Ω–∏—Ö –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–µ–π"""
    
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏
    from itertools import permutations
    import math
    
    all_permutations = list(permutations(participants))
    total_permutations = math.factorial(len(participants))
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏
    # –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Ö—Ä–∞–Ω–∏–º (N! - 1) –∏–≥—Ä
    if max_history is None:
        max_history = total_permutations - 1
    
    # –ò—Å–∫–ª—é—á–∞–µ–º –Ω–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏
    recent_queues = previous_queues[-max_history:]
    available_queues = [
        perm for perm in all_permutations 
        if list(perm) not in recent_queues
    ]
    
    # –ï—Å–ª–∏ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ü–∏–∫–ª
    if not available_queues:
        available_queues = all_permutations
        # –õ–æ–≥–∏—Ä—É–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
        print(f"üîÑ –ó–∞–≤–µ—Ä—à–µ–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–∑ {total_permutations} –∏–≥—Ä. –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ü–∏–∫–ª.")
    
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
    return list(random.choice(available_queues))

# –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê –ê–õ–ì–û–†–ò–¢–ú–ê:

# –î–õ–Ø 2 –ò–ì–†–û–ö–û–í (2! = 2 –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏):
# –ò–≥—Ä–∞ 1: –ê ‚Üí –ë
# –ò–≥—Ä–∞ 2: –ë ‚Üí –ê (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—É 1)
# –ò–≥—Ä–∞ 3: –ê ‚Üí –ë (—Å–±—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ - –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ 2 –∏–≥—Ä)

# –î–õ–Ø 3 –ò–ì–†–û–ö–û–í (3! = 6 –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫):
# –ò–≥—Ä–∞ 1: –ê ‚Üí –ë ‚Üí –í
# –ò–≥—Ä–∞ 2: –í ‚Üí –ê ‚Üí –ë (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—É 1)
# –ò–≥—Ä–∞ 3: –ë ‚Üí –í ‚Üí –ê (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-2)
# –ò–≥—Ä–∞ 4: –ê ‚Üí –í ‚Üí –ë (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-3)
# –ò–≥—Ä–∞ 5: –ë ‚Üí –ê ‚Üí –í (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-4)
# –ò–≥—Ä–∞ 6: –í ‚Üí –ë ‚Üí –ê (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-5)
# –ò–≥—Ä–∞ 7: –ê ‚Üí –ë ‚Üí –í (—Å–±—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ - –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ 6 –∏–≥—Ä)

# –î–õ–Ø 4 –ò–ì–†–û–ö–û–í (4! = 24 –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∏):
# –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ 25-–π –∏–≥—Ä–µ
```

**–ü–ª—é—Å—ã**:
- –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –≤ –±–ª–∏–∂–∞–π—à–∏—Ö –∏–≥—Ä–∞—Ö
- –≠–ª–µ–º–µ–Ω—Ç —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ì–∞—Ä–∞–Ω—Ç–∏—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è

**–ú–∏–Ω—É—Å—ã**:
- –°–ª–æ–∂–Ω–µ–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –¢—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–µ–π
- –î–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏

#### 3. **Manual** (–†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç–µ–ª—å —Å–µ—Å—Å–∏–∏ –≤—Ä—É—á–Ω—É—é –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –∏–≥—Ä–æ–π.

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:
```python
def set_manual_queue(
    participants: List[Participant],
    creator_choice: List[UUID]
) -> List[Participant]:
    """–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–º —Å–µ—Å—Å–∏–∏"""
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞
    if len(creator_choice) != len(participants):
        raise ValueError("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç")
    
    if set(creator_choice) != set(p.id for p in participants):
        raise ValueError("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤")
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –ø–æ –≤—ã–±–æ—Ä—É —Å–æ–∑–¥–∞—Ç–µ–ª—è
    ordered_participants = []
    for participant_id in creator_choice:
        participant = next(p for p in participants if p.id == participant_id)
        ordered_participants.append(participant)
    
    return ordered_participants
```

**–ü–ª—é—Å—ã**:
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–∑–¥–∞—Ç–µ–ª—è —Å–µ—Å—Å–∏–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –ì–∏–±–∫–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏

**–ú–∏–Ω—É—Å—ã**:
- –¢—Ä–µ–±—É–µ—Ç –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –∏–≥—Ä–æ–π
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ
- –ó–∞–º–µ–¥–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–µ–π
CREATE TABLE session_queue_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID NOT NULL REFERENCES game_sessions(id) ON DELETE CASCADE,
    game_number INTEGER NOT NULL,
    queue_order JSONB NOT NULL, -- –ú–∞—Å—Å–∏–≤ participant_id –≤ –ø–æ—Ä—è–¥–∫–µ –æ—á–µ—Ä–µ–¥–∏
    algorithm_used VARCHAR(50) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(session_id, game_number)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_queue_history_session ON session_queue_history(session_id);
CREATE INDEX idx_queue_history_game_number ON session_queue_history(session_id, game_number);
```

### API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å—é

```python
@router.post("/sessions/{session_id}/games/{game_number}/queue")
async def generate_game_queue(
    session_id: UUID,
    game_number: int,
    current_user: User = Depends(get_current_user)
):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã"""
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–µ—Å—Å–∏—é –∏ –µ—ë –ø—Ä–∞–≤–∏–ª–∞
    session = await get_session_by_id(session_id)
    template = await get_template_by_id(session.template_id)
    rules = KolkhozRules(**template.rules)
    
    # –ü–æ–ª—É—á–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    participants = await get_session_participants(session_id)
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    if rules.queue_algorithm == "always_random":
        queue = await generate_always_random_queue(participants)
    elif rules.queue_algorithm == "random_no_repeat":
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —à–∞–±–ª–æ–Ω–∞
        import math
        history_size = template.settings.get("queue_history_size", "auto")
        if history_size == "auto":
            history_size = math.factorial(len(participants)) - 1
        
        previous_queues = await get_recent_queue_history(session_id, limit=history_size)
        queue = await generate_random_no_repeat_queue(participants, previous_queues, history_size)
    elif rules.queue_algorithm == "manual":
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ—Ä—è–¥–æ–∫, –∂–¥–µ–º —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        queue = participants
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏–∏
    await save_queue_history(session_id, game_number, queue, rules.queue_algorithm)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –≤ session_participants
    await update_participant_positions(queue)
    
    return {
        "queue": [{"participant_id": p.id, "display_name": p.display_name, "position": i+1} 
                 for i, p in enumerate(queue)],
        "algorithm": rules.queue_algorithm
    }

@router.put("/sessions/{session_id}/games/{game_number}/queue/manual")
async def set_manual_queue(
    session_id: UUID,
    game_number: int,
    queue_order: List[UUID],
    current_user: User = Depends(get_current_user)
):
    """–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è —Å–µ—Å—Å–∏–∏)"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
    session = await get_session_by_id(session_id)
    if session.creator_user_id != current_user.id:
        raise HTTPException(403, "–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å —Å–µ—Å—Å–∏–∏ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å")
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä—É—á–Ω—É—é –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å
    participants = await get_session_participants(session_id)
    queue = await set_manual_participant_queue(participants, queue_order)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏–∏
    await save_queue_history(session_id, game_number, queue, "manual")
    
    return {"status": "success", "queue": queue}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ —à–∞–±–ª–æ–Ω–∞—Ö

```json
{
    "name": "–ö–æ–ª—Ö–æ–∑ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π",
    "rules": {
        "game_type": "kolkhoz",
        "point_value_rubles": 50.00,
        "queue_algorithm": "random_no_repeat",
        "balls": [/* –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —à–∞—Ä–æ–≤ */]
    },
    "settings": {
        "queue_history_size": "auto",  // "auto" = (N!-1), –∏–ª–∏ —á–∏—Å–ª–æ –¥–ª—è —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        "show_queue_preview": true,  // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å
        "allow_queue_manual_override": false,  // –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å
        "notify_cycle_completion": true  // –£–≤–µ–¥–æ–º–ª—è—Ç—å –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
    }
}
```

### WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:**
```json
{
    "type": "queue_generated",
    "session_id": "session-uuid",
    "game_number": 3,
    "queue": [
        {"participant_id": "uuid-1", "display_name": "–ò–≥—Ä–æ–∫ 1", "position": 1},
        {"participant_id": "uuid-2", "display_name": "–ò–≥—Ä–æ–∫ 2", "position": 2},
        {"participant_id": "uuid-3", "display_name": "–ò–≥—Ä–æ–∫ 3", "position": 3}
    ],
    "algorithm": "random_no_repeat",
    "message": "–û—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –¥–ª—è –∏–≥—Ä—ã 3 —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞",
    "is_new_cycle": false,
    "total_permutations": 6,
    "games_until_repeat": 3
}
```

**–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ü–∏–∫–ª–∞ (–¥–ª—è 3 –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ 7-–π –∏–≥—Ä–µ):**
```json
{
    "type": "queue_cycle_completed",
    "session_id": "session-uuid", 
    "game_number": 7,
    "queue": [
        {"participant_id": "uuid-1", "display_name": "–ò–≥—Ä–æ–∫ 1", "position": 1},
        {"participant_id": "uuid-2", "display_name": "–ò–≥—Ä–æ–∫ 2", "position": 2},
        {"participant_id": "uuid-3", "display_name": "–ò–≥—Ä–æ–∫ 3", "position": 3}
    ],
    "algorithm": "random_no_repeat",
    "message": "üîÑ –ó–∞–≤–µ—Ä—à–µ–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–∑ 6 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–µ–π. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π —Ü–∏–∫–ª.",
    "is_new_cycle": true,
    "completed_cycle_games": 6,
    "total_permutations": 6
}
```

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏

```python
@router.get("/sessions/{session_id}/queue/analytics")
async def get_queue_analytics(session_id: UUID):
    """–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏"""
    
    history = await get_full_queue_history(session_id)
    
    # –ü–æ–¥—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
    position_stats = {}
    for record in history:
        for i, participant_id in enumerate(record.queue_order):
            if participant_id not in position_stats:
                position_stats[participant_id] = {"total_games": 0, "positions": {}}
            
            position_stats[participant_id]["total_games"] += 1
            pos = i + 1
            if pos not in position_stats[participant_id]["positions"]:
                position_stats[participant_id]["positions"][pos] = 0
            position_stats[participant_id]["positions"][pos] += 1
    
    # –†–∞—Å—á–µ—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ)
    fairness_score = calculate_fairness_score(position_stats)
    
    return {
        "position_statistics": position_stats,
        "fairness_score": fairness_score,
        "total_games": len(history)
    }
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π

**–î–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏–≥—Ä (3-5 –∏–≥—Ä)**:
```json
{"queue_algorithm": "always_random"}
```

**–î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π (10+ –∏–≥—Ä)**:
```json
{"queue_algorithm": "random_no_repeat", "queue_history_size": "auto"}
```

### üìä –°–ø—Ä–∞–≤–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –¥–ª—è "Random No Repeat"

| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ | –í–æ–∑–º–æ–∂–Ω—ã—Ö –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ (N!) | –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –Ω–∞ –∏–≥—Ä–µ | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª |
|-------------------|----------------------------|------------------------------|-------------|
| **2 –∏–≥—Ä–æ–∫–∞** | 2 | **3-—è –∏–≥—Ä–∞** | 2 –∏–≥—Ä—ã |
| **3 –∏–≥—Ä–æ–∫–∞** | 6 | **7-—è –∏–≥—Ä–∞** | 6 –∏–≥—Ä |
| **4 –∏–≥—Ä–æ–∫–∞** | 24 | **25-—è –∏–≥—Ä–∞** | 24 –∏–≥—Ä—ã |
| **5 –∏–≥—Ä–æ–∫–æ–≤** | 120 | **121-—è –∏–≥—Ä–∞** | 120 –∏–≥—Ä |
| **6 –∏–≥—Ä–æ–∫–æ–≤** | 720 | **721-—è –∏–≥—Ä–∞** | 720 –∏–≥—Ä |

**‚ö†Ô∏è –û–¢–í–ï–¢–´ –ù–ê –í–ê–®–ò –í–û–ü–†–û–°–´:**

‚úÖ **–î–ª—è 2 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ—Å–ª–µ 2 –∏–≥—Ä –Ω–∞ 3-–π –∏–≥—Ä–µ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ**
- –ò–≥—Ä–∞ 1: –ê ‚Üí –ë
- –ò–≥—Ä–∞ 2: –ë ‚Üí –ê  
- –ò–≥—Ä–∞ 3: **–ê ‚Üí –ë (–ø–æ–≤—Ç–æ—Ä)**

‚úÖ **–î–ª—è 3 –∏–≥—Ä–æ–∫–æ–≤ –ø–æ—Å–ª–µ 6 –∏–≥—Ä –Ω–∞ 7-–π –∏–≥—Ä–µ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ**  
- –ò–≥—Ä—ã 1-6: –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
- –ò–≥—Ä–∞ 7: **–ø–æ–≤—Ç–æ—Ä –æ–¥–Ω–æ–π –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö**

**üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã:**
- –î–ª—è **2 –∏–≥—Ä–æ–∫–æ–≤**: –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å —á–µ—Ä–µ–¥—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 2 –∏–≥—Ä—ã
- –î–ª—è **3 –∏–≥—Ä–æ–∫–æ–≤**: –ø–æ–ª–Ω—ã–π —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π —Ü–∏–∫–ª = 6 –∏–≥—Ä  
- –î–ª—è **4+ –∏–≥—Ä–æ–∫–æ–≤**: –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—á–µ–Ω—å —Ä–µ–¥–∫–∏–µ (24+ –∏–≥—Ä)

**–î–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤ –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π**:
```json
{"queue_algorithm": "manual"}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏

```python
@router.post("/sessions")
async def create_game_session(
    session_data: SessionCreate,
    current_user: User = Depends(get_current_user)
):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞"""
    
    # –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω
    template = await get_template_by_id(session_data.template_id)
    if not template:
        raise HTTPException(404, "–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
    session = await create_session_with_template(
        creator_id=current_user.id,
        template=template,
        session_name=session_data.name,
        custom_settings=session_data.custom_settings
    )
    
    return session

async def create_session_with_template(
    creator_id: UUID, 
    template: GameTemplate, 
    session_name: str,
    custom_settings: Optional[Dict] = None
):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —à–∞–±–ª–æ–Ω–∞"""
    
    # –ü–∞—Ä—Å–∏–º –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
    rules = template.rules
    settings = {**template.settings}
    
    # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    if custom_settings:
        settings.update(custom_settings)
    
    # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é
    session = await create_game_session_db(
        creator_user_id=creator_id,
        template_id=template.id,
        name=session_name,
        rules=rules,
        max_players=rules.get("max_players", 4)
    )
    
    return session
```

### –°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤–µ—Ä—Å–∏–π —à–∞–±–ª–æ–Ω–æ–≤ (–±—É–¥—É—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
CREATE TABLE template_versions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_id UUID NOT NULL REFERENCES game_templates(id) ON DELETE CASCADE,
    version_number INTEGER NOT NULL,
    rules JSONB NOT NULL,
    settings JSONB,
    change_description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by_user_id UUID NOT NULL,
    UNIQUE(template_id, version_number)
);
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Game Service

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã

```python
async def start_game_with_template(session_id: UUID, template_rules: Dict):
    """–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª —à–∞–±–ª–æ–Ω–∞"""
    
    # –ü–∞—Ä—Å–∏–º –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã
    if template_rules["game_type"] == "kolkhoz":
        game_rules = KolkhozRules(**template_rules)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –∫ –∏–≥—Ä–µ
        await initialize_kolkhoz_game(
            session_id=session_id,
            balls_config=game_rules.balls,
            point_value=game_rules.point_value_rubles,
            payment_direction=game_rules.payment_direction
        )
    
    # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –∏–≥—Ä
```

### WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞

```json
{
    "type": "template_applied",
    "session_id": "session-uuid",
    "template": {
        "name": "–ö–æ–ª—Ö–æ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π",
        "game_type": "kolkhoz",
        "point_value_rubles": 50.00,
        "max_players": 6
    },
    "message": "–ü—Ä–∏–º–µ–Ω–µ–Ω —à–∞–±–ª–æ–Ω: –ö–æ–ª—Ö–æ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (50‚ÇΩ –∑–∞ –æ—á–∫–æ)"
}
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤

```mermaid
graph TD
    subgraph "Template Service"
        TS[Template Service API]
        TV[Template Validator]
        TC[Template Categories]
        TF[Template Favorites]
    end
    
    subgraph "Game Service" 
        GS[Game Session Creator]
        GR[Game Rules Engine]
    end
    
    subgraph "Frontend"
        TL[Template Library UI]
        TE[Template Editor]
        GP[Game Setup Page]
    end
    
    subgraph "Database"
        GTB[(game_templates)]
        TCB[(template_categories)]
        TFB[(template_favorites)]
        RDB[(rule_definitions)]
    end
    
    TL --> TS
    TE --> TS
    GP --> TS
    
    TS --> TV
    TS --> GTB
    TS --> TCB
    TS --> TFB
    TS --> RDB
    
    GS --> TS
    GR --> TS
    
    TS --> GS
```

## –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–∏–≤ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–≥—Ä**: –û—Ç–¥–µ–ª—å–Ω—ã–µ Pydantic –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —à–∞–±–ª–æ–Ω—ã**: –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤
‚úÖ **–ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è**: –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏  
‚úÖ **–ò–∑–±—Ä–∞–Ω–Ω–æ–µ**: –°–∏—Å—Ç–µ–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
‚úÖ **–ü—É–±–ª–∏—á–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –¥–æ—Å—Ç—É–ø–∞
‚úÖ **–°–∏—Å—Ç–µ–º–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã**: –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã
‚úÖ **–°–ø–µ—Ü–∏—Ñ–∏–∫–∞ –ö–æ–ª—Ö–æ–∑–∞**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, —à–∞—Ä–æ–≤, –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏
‚úÖ **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Template Service
‚úÖ **API**: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä REST API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
- Redis –∫–µ—à –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤

### –ò–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É –∏–≥—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é —à–∞–±–ª–æ–Ω–æ–≤
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

üé®üé®üé® EXITING CREATIVE PHASE: GAME TEMPLATES SYSTEM üé®üé®üé®

**–ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –ì–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (Pydantic + —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ JSON –ø–æ–ª—è)
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ 
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∏–≥—Ä—ã
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑"
- –°–∏—Å—Ç–µ–º–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∏ –ø—É–±–ª–∏—á–Ω—ã—Ö/–ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Game Service —á–µ—Ä–µ–∑ Template Service API
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –±—É–¥—É—â–µ–º—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é)

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤ —Å UI/UX –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä