# –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –∏–≥—Ä

üé®üé®üé® **ENTERING CREATIVE PHASE: API DESIGN** üé®üé®üé®

## –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

API —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏ –±–∏–ª—å—è—Ä–¥–Ω—ã—Ö –∏–≥—Ä –≤ —Ä–∞–º–∫–∞—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. API –¥–æ–ª–∂–µ–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É 6 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑" –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å seamless –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞**: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏, real-time —Å–æ–±—ã—Ç–∏—è (–∑–∞–±–∏—Ç—ã–µ —à–∞—Ä—ã, —Ñ–æ–ª—ã)
- **–°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤**: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ –∏–≥—Ä —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π Pydantic
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT —á–µ—Ä–µ–∑ Telegram Mini Apps API
- **Real-time**: WebSocket –¥–ª—è live –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –∏ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
- **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**: –°–∏—Å—Ç–µ–º–∞ –¥—Ä—É–∑–µ–π, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **–°–ª–æ–∂–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã**: –õ–æ–≥–∏–∫–∞ "–ö–æ–ª—Ö–æ–∑" —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã**: 6 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Auth, Game, Stats, Friends, Template, Notification)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: Database-per-service pattern (PostgreSQL)
- **Messaging**: RabbitMQ –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: < 100ms response time –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 1000 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: Telegram Mini Apps, –º–æ–±–∏–ª—å–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã

### –ë–∏–∑–Ω–µ—Å-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **–í–∞–ª—é—Ç–∞**: –†–∞–±–æ—Ç–∞ —Å —Ä—É–±–ª—è–º–∏ (—Ç–æ—á–Ω–æ—Å—Ç—å –¥–æ –∫–æ–ø–µ–µ–∫)
- **–†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞**: –°–æ–∑–¥–∞—Ç–µ–ª—å/—É—á–∞—Å—Ç–Ω–∏–∫ —Å–µ—Å—Å–∏–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- **–ò–≥—Ä–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ "–ö–æ–ª—Ö–æ–∑", "–ê–º–µ—Ä–∏–∫–∞–Ω–∫–∞", "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞"
- **–û—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å**: 3 –∞–ª–≥–æ—Ä–∏—Ç–º–∞ (Always Random, Random No Repeat, Manual)

## –í–∞—Ä–∏–∞–Ω—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã API

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π API Gateway

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ï–¥–∏–Ω—ã–π API Gateway –∫–æ—Ç–æ—Ä—ã–π –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
Frontend ‚Üí API Gateway ‚Üí [Auth|Game|Stats|Friends|Template|Notification] Services
                ‚Üì
           RabbitMQ Events
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ü—Ä–æ—Å—Ç–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ï–¥–∏–Ω–∞—è —Å—Ö–µ–º–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è API
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞ (Single Point of Failure)
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è Gateway –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –†–∏—Å–∫ —Å–æ–∑–¥–∞–Ω–∏—è "–º–∏–Ω–∏-–º–æ–Ω–æ–ª–∏—Ç–∞" –≤ Gateway
- –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π BFF (Backend for Frontend)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –¥–æ–º–µ–Ω –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API endpoint, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
Frontend ‚Üí [Game API | Auth API | Stats API | Social API] ‚Üí Microservices
                              ‚Üì
                        RabbitMQ Events
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ use cases —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –∏ –¥–µ–ø–ª–æ–π –∫–∞–∂–¥–æ–≥–æ API
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –æ—Ç–∫–∞–∑–∞
- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–µ—Ç –ª–∏—à–Ω–∏—Ö proxy —Å–ª–æ–µ–≤)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ endpoint'–∞–º–∏
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ backward compatibility
- –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–¥–∞ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ URL)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (API Gateway + Service-Specific Endpoints)

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–º–±–∏–Ω–∞—Ü–∏—è Gateway –¥–ª—è –æ–±—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (auth, routing) –∏ –ø—Ä—è–º—ã—Ö endpoint'–æ–≤ –¥–ª—è performance-critical –æ–ø–µ—Ä–∞—Ü–∏–π.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
Frontend ‚Üí API Gateway (Auth, Routing, Rate Limiting)
    ‚Üì
[Common API] + [Game WebSocket] + [Stats Stream] + [Notifications WS]
    ‚Üì
Microservices + RabbitMQ Events
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –ì–∏–±–∫–æ—Å—Ç—å –≤ –≤—ã–±–æ—Ä–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ security concerns
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π (real-time –∏–≥—Ä—ã)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —á–µ—Ç–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—É—Ç–∞–Ω–∏—Ü–∞ –≤ routing –ª–æ–≥–∏–∫–µ

## –ê–Ω–∞–ª–∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏:
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —Å–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞—Å—Ç—É—â—É—é –Ω–∞–≥—Ä—É–∑–∫—É
3. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - –ø—Ä–æ—Å—Ç–æ—Ç–∞ implementation –∏ maintenance
4. **Fault tolerance** - —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—Ç–∫–∞–∑–∞–º
5. **Developer Experience** - —É–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –û—Ü–µ–Ω–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π Gateway | –î–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π BFF | –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
|----------|-------------------|------------------------|----------------------|
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê |
| **Fault tolerance** | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **Developer Experience** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê |

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### **–í—ã–±–æ—Ä: –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–í–∞—Ä–∏–∞–Ω—Ç 3)**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ**:
1. **Telegram Mini Apps —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π WebSocket –¥–ª—è real-time –∏–≥—Ä
2. **–ë–∏–∑–Ω–µ—Å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–æ–ª–∂–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è < 50ms
3. **–ë–∞–ª–∞–Ω—Å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏**: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–∏–±–∫–∞—è, –Ω–æ –Ω–µ overcomplicated
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ú–æ–∂–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

```mermaid
graph TB
    Frontend[React Frontend<br/>Telegram Mini App]
    
    subgraph "API Layer"
        Gateway[API Gateway<br/>Kong/Traefik]
        GameWS[Game WebSocket<br/>Real-time Events]
        StatsWS[Stats WebSocket<br/>Live Analytics]
        NotifyWS[Notification WebSocket<br/>Social Updates]
    end
    
    subgraph "Service Layer"
        AuthSvc[Auth Service]
        GameSvc[Game Service]
        StatsSvc[Stats Service]
        FriendsSvc[Friends Service]
        TemplateSvc[Template Service]
        NotifySvc[Notification Service]
    end
    
    subgraph "Infrastructure"
        RabbitMQ[RabbitMQ<br/>Event Bus]
        Redis[Redis<br/>Session Store]
        PostgreSQL[PostgreSQL<br/>5 Databases]
    end
    
    Frontend --> Gateway
    Frontend --> GameWS
    Frontend --> StatsWS
    Frontend --> NotifyWS
    
    Gateway --> AuthSvc
    Gateway --> GameSvc
    Gateway --> StatsSvc
    Gateway --> FriendsSvc
    Gateway --> TemplateSvc
    Gateway --> NotifySvc
    
    GameWS --> GameSvc
    StatsWS --> StatsSvc
    NotifyWS --> NotifySvc
    
    AuthSvc --> Redis
    GameSvc --> PostgreSQL
    StatsSvc --> PostgreSQL
    FriendsSvc --> PostgreSQL
    TemplateSvc --> PostgreSQL
    NotifySvc --> PostgreSQL
    
    GameSvc --> RabbitMQ
    StatsSvc --> RabbitMQ
    FriendsSvc --> RabbitMQ
    NotifySvc --> RabbitMQ
    
    style Frontend fill:#e1f5fe
    style Gateway fill:#fff3e0
    style GameWS fill:#e8f5e8
    style StatsWS fill:#e8f5e8
    style NotifyWS fill:#e8f5e8
    style RabbitMQ fill:#fce4ec
    style Redis fill:#fff8e1
    style PostgreSQL fill:#f3e5f5
```

## Implementation Guidelines

### 1. API Gateway Configuration

**Technology Stack**: Kong Gateway –∏–ª–∏ Traefik
**Responsibilities**:
- Authentication middleware (JWT validation)
- Rate limiting (100 requests/minute per user)
- Request/Response logging
- CORS handling for Telegram Mini Apps
- API versioning (/api/v1/)
- Health checks aggregation

**Configuration example**:
```yaml
# kong.yml
_format_version: "3.0"
services:
- name: auth-service
  url: http://auth-service:8001
  routes:
  - name: auth-routes
    paths: ["/api/v1/auth"]
    
- name: game-service
  url: http://game-service:8002
  routes:
  - name: game-routes
    paths: ["/api/v1/games", "/api/v1/sessions"]

plugins:
- name: jwt
  config:
    secret_is_base64: false
    key_claim_name: "iss"
- name: rate-limiting
  config:
    minute: 100
    policy: "local"
```

### 2. REST API Design

**URL Structure**:
```
/api/v1/auth/*          ‚Üí Auth Service
/api/v1/games/*         ‚Üí Game Service  
/api/v1/sessions/*      ‚Üí Game Service
/api/v1/templates/*     ‚Üí Template Service
/api/v1/stats/*         ‚Üí Stats Service
/api/v1/friends/*       ‚Üí Friends Service
/api/v1/notifications/* ‚Üí Notification Service
```

**HTTP Status Codes**:
- 200: Success
- 201: Created
- 204: No Content
- 400: Bad Request (validation errors)
- 401: Unauthorized
- 403: Forbidden (insufficient permissions)
- 404: Not Found
- 409: Conflict (business logic violations)
- 422: Unprocessable Entity (Pydantic validation)
- 429: Too Many Requests
- 500: Internal Server Error

### 3. WebSocket Architecture

**Real-time Endpoints**:
```
ws://api.domain.com/ws/games/{session_id}      ‚Üí Game events
ws://api.domain.com/ws/stats/{user_id}         ‚Üí Personal stats updates
ws://api.domain.com/ws/notifications/{user_id} ‚Üí Social notifications
```

**Message Format**:
```json
{
    "type": "game_event" | "stats_update" | "notification",
    "timestamp": "2024-01-20T15:30:00Z",
    "session_id": "uuid",
    "user_id": "uuid", 
    "data": {
        // Event-specific payload
    }
}
```

### 4. Pydantic Schemas

**Base Response Schema**:
```python
from pydantic import BaseModel, Field
from typing import Optional, Any
from datetime import datetime

class APIResponse(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –æ—Ç–≤–µ—Ç–∞ API"""
    success: bool = True
    message: Optional[str] = None
    data: Optional[Any] = None
    timestamp: datetime = Field(default_factory=datetime.utcnow)
    request_id: Optional[str] = None

class APIError(BaseModel):
    """–°—Ö–µ–º–∞ –æ—à–∏–±–∫–∏ API"""
    success: bool = False
    error_code: str
    message: str
    details: Optional[dict] = None
    timestamp: datetime = Field(default_factory=datetime.utcnow)
    request_id: Optional[str] = None
```

### 5. Service Communication via RabbitMQ

**Event Types**:
```python
class GameEventType(Enum):
    GAME_STARTED = "game_started"
    BALL_POTTED = "ball_potted"
    FOUL_COMMITTED = "foul_committed"
    GAME_ENDED = "game_ended"
    SESSION_COMPLETED = "session_completed"

class StatsEventType(Enum):
    STATS_UPDATED = "stats_updated"
    LEADERBOARD_CHANGED = "leaderboard_changed"

class SocialEventType(Enum):
    FRIEND_REQUEST = "friend_request"
    INVITATION_SENT = "invitation_sent"
    NOTIFICATION_CREATED = "notification_created"
```

**RabbitMQ Message Format**:
```json
{
    "event_type": "ball_potted",
    "event_id": "uuid",
    "timestamp": "2024-01-20T15:30:00Z",
    "source_service": "game_service",
    "correlation_id": "uuid",
    "payload": {
        "session_id": "uuid",
        "game_id": "uuid", 
        "player_id": "uuid",
        "ball_color": "red",
        "ball_points": 4,
        "total_score": 12
    }
}
```

### 6. Error Handling Strategy

**Global Exception Handler**:
```python
from fastapi import FastAPI, HTTPException, Request
from fastapi.responses import JSONResponse
import logging

app = FastAPI()

@app.exception_handler(HTTPException)
async def http_exception_handler(request: Request, exc: HTTPException):
    return JSONResponse(
        status_code=exc.status_code,
        content=APIError(
            error_code=f"HTTP_{exc.status_code}",
            message=exc.detail,
            request_id=request.headers.get("X-Request-ID")
        ).dict()
    )

@app.exception_handler(ValidationError)
async def validation_exception_handler(request: Request, exc: ValidationError):
    return JSONResponse(
        status_code=422,
        content=APIError(
            error_code="VALIDATION_ERROR",
            message="Request validation failed",
            details=exc.errors(),
            request_id=request.headers.get("X-Request-ID")
        ).dict()
    )
```

### 7. Authentication Flow

**JWT Token Structure**:
```python
{
    "sub": "user_uuid",           # User ID
    "iss": "artel_billiards",     # Issuer
    "aud": "telegram_mini_app",   # Audience
    "exp": 1642684800,            # Expiration
    "iat": 1642681200,            # Issued at
    "telegram_id": "123456789",   # Telegram User ID
    "username": "john_doe",       # Telegram Username
    "permissions": ["user", "session_creator"]
}
```

**Middleware Implementation**:
```python
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer
import jwt

security = HTTPBearer()

async def get_current_user(token: str = Depends(security)) -> User:
    try:
        payload = jwt.decode(token.credentials, SECRET_KEY, algorithms=["HS256"])
        user_id = payload.get("sub")
        if not user_id:
            raise HTTPException(status_code=401, detail="Invalid token")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Auth Service
        user = await auth_service.get_user_by_id(user_id)
        if not user:
            raise HTTPException(status_code=401, detail="User not found")
            
        return user
    except jwt.ExpiredSignatureError:
        raise HTTPException(status_code=401, detail="Token expired")
    except jwt.JWTError:
        raise HTTPException(status_code=401, detail="Invalid token")
```

## Verification Checkpoint

### API Design Verification:

‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è**:
- –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤—ã–±—Ä–∞–Ω–∞ –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∞
- API Gateway –¥–ª—è –æ–±—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä—è–º—ã–µ WebSocket –¥–ª—è real-time –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
- WebSocket –¥–ª—è real-time —Å–æ–±—ã—Ç–∏–π (< 50ms latency)
- –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫—Ä–∏—Ç–∏—á–Ω—ã–º —Å–µ—Ä–≤–∏—Å–∞–º
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Redis –¥–ª—è auth –¥–∞–Ω–Ω—ã—Ö
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ RabbitMQ

‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**:
- –ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è horizontal scaling
- Event-driven communication –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

‚úÖ **Developer Experience**:
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ API Gateway
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è —Å—Ö–µ–º–∞ –æ—Ç–≤–µ—Ç–æ–≤ (Pydantic)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (OpenAPI)
- –ß–µ—Ç–∫–∏–π error handling

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- Rate limiting –Ω–∞ Gateway —É—Ä–æ–≤–Ω–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Telegram Mini Apps

## –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API Endpoints

### Auth Service API (`/api/v1/auth`)

```python
# Telegram Auth
POST   /auth/telegram          # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Mini Apps
POST   /auth/refresh           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
POST   /auth/logout            # Logout –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /auth/me                # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
PUT    /auth/me                # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

# User Management
GET    /users/{user_id}        # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /users/search           # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ username/–∏–º–µ–Ω–∏
```

**Pydantic Schemas**:
```python
class TelegramAuthRequest(BaseModel):
    telegram_user_id: int
    username: Optional[str]
    first_name: str
    last_name: Optional[str]
    auth_date: int
    hash: str  # Telegram signature

class AuthResponse(BaseModel):
    access_token: str
    refresh_token: str
    token_type: str = "bearer"
    expires_in: int
    user: UserProfile

class UserProfile(BaseModel):
    id: UUID
    telegram_user_id: int
    username: Optional[str]
    display_name: str
    avatar_url: Optional[str]
    created_at: datetime
    is_verified: bool
```

### Game Service API (`/api/v1/games`, `/api/v1/sessions`)

```python
# Session Management
POST   /sessions               # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∏–≥—Ä–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
GET    /sessions               # –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /sessions/{session_id}  # –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏
PUT    /sessions/{session_id}  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–µ—Å—Å–∏–∏
DELETE /sessions/{session_id}  # –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
POST   /sessions/{session_id}/join     # –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏
POST   /sessions/{session_id}/leave    # –ü–æ–∫–∏–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
POST   /sessions/{session_id}/invite   # –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞

# Game Management
POST   /sessions/{session_id}/games           # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∏–≥—Ä—ã –≤ —Å–µ—Å—Å–∏–∏
GET    /sessions/{session_id}/games           # –°–ø–∏—Å–æ–∫ –∏–≥—Ä –≤ —Å–µ—Å—Å–∏–∏
GET    /games/{game_id}                       # –î–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–≥—Ä—ã
POST   /games/{game_id}/start                 # –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
POST   /games/{game_id}/end                   # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
POST   /games/{game_id}/events                # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
GET    /games/{game_id}/events                # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π –∏–≥—Ä—ã
GET    /games/{game_id}/scores                # –¢–µ–∫—É—â–∏–µ —Å—á–µ—Ç–∞ –∏–≥—Ä—ã

# Queue Management
POST   /sessions/{session_id}/games/{game_number}/queue        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏
PUT    /sessions/{session_id}/games/{game_number}/queue/manual # –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏
GET    /sessions/{session_id}/queue/analytics                  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏
```

**Pydantic Schemas**:
```python
class CreateSessionRequest(BaseModel):
    name: str = Field(min_length=1, max_length=100)
    template_id: UUID
    max_participants: int = Field(ge=2, le=8)
    is_private: bool = False
    description: Optional[str] = Field(max_length=500)

class SessionResponse(BaseModel):
    id: UUID
    name: str
    creator: UserProfile
    template: GameTemplateInfo
    participants: List[SessionParticipant]
    status: SessionStatus
    current_game_number: int
    created_at: datetime
    settings: dict

class GameEventRequest(BaseModel):
    event_type: GameEventType
    player_id: UUID
    details: dict  # –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
    timestamp: datetime = Field(default_factory=datetime.utcnow)

class KolkhozBallPottedEvent(BaseModel):
    ball_color: str
    ball_points: int
    position_x: Optional[float]  # –î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    position_y: Optional[float]
```

### Template Service API (`/api/v1/templates`)

```python
# Template CRUD
GET    /templates              # –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
POST   /templates              # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
GET    /templates/{template_id}  # –î–µ—Ç–∞–ª–∏ —à–∞–±–ª–æ–Ω–∞
PUT    /templates/{template_id}  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞
DELETE /templates/{template_id}  # –£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞

# Template Categories
GET    /templates/categories   # –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —à–∞–±–ª–æ–Ω–æ–≤
GET    /templates/categories/{category_id}/templates  # –®–∞–±–ª–æ–Ω—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

# Template Validation
POST   /templates/validate     # –í–∞–ª–∏–¥–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
```

### Stats Service API (`/api/v1/stats`)

```python
# Personal Statistics
GET    /stats/users/{user_id}               # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä–æ–∫–∞
GET    /stats/users/{user_id}/games         # –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä
GET    /stats/users/{user_id}/sessions      # –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π
GET    /stats/users/{user_id}/achievements  # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞

# Game Statistics
GET    /stats/games/{game_id}              # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∏–≥—Ä—ã
GET    /stats/sessions/{session_id}        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–∏

# Global Statistics
GET    /stats/leaderboard                  # –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
GET    /stats/leaderboard/weekly           # –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
GET    /stats/trends                       # –¢—Ä–µ–Ω–¥—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
```

### Friends Service API (`/api/v1/friends`)

```python
# Friends Management
GET    /friends                    # –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
POST   /friends/requests           # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è
GET    /friends/requests           # –í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏
PUT    /friends/requests/{request_id}/accept   # –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞—è–≤–∫–∏
PUT    /friends/requests/{request_id}/decline  # –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
DELETE /friends/{friend_id}        # –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –¥—Ä—É–∑–µ–π

# Social Features
GET    /friends/{friend_id}/stats  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥—Ä—É–≥–∞
POST   /friends/{friend_id}/invite # –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥—Ä—É–≥–∞ –≤ –∏–≥—Ä—É
```

### Notification Service API (`/api/v1/notifications`)

```python
# Notifications
GET    /notifications              # –°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PUT    /notifications/{notification_id}/read  # –û—Ç–º–µ—Ç–∫–∞ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
DELETE /notifications/{notification_id}       # –£–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
POST   /notifications/mark-all-read           # –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ

# Push Settings
GET    /notifications/settings     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
PUT    /notifications/settings     # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

## WebSocket Events Specification

### Game Events (`ws://api.domain.com/ws/games/{session_id}`)

```python
class GameWebSocketMessage(BaseModel):
    type: GameEventType
    session_id: UUID
    game_id: Optional[UUID]
    timestamp: datetime
    data: dict

# –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π:
class GameEventType(Enum):
    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π
    GAME_STARTED = "game_started"
    GAME_ENDED = "game_ended"
    GAME_PAUSED = "game_paused"
    GAME_RESUMED = "game_resumed"
    
    # –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
    BALL_POTTED = "ball_potted"
    FOUL_COMMITTED = "foul_committed"
    TURN_CHANGED = "turn_changed"
    SCORE_UPDATED = "score_updated"
    
    # –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è  
    PLAYER_JOINED = "player_joined"
    PLAYER_LEFT = "player_left"
    QUEUE_UPDATED = "queue_updated"
    SETTINGS_CHANGED = "settings_changed"
```

**–ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π**:
```json
{
    "type": "ball_potted",
    "session_id": "session-uuid",
    "game_id": "game-uuid",
    "timestamp": "2024-01-20T15:30:00Z",
    "data": {
        "player_id": "player-uuid",
        "player_name": "–ò–≥—Ä–æ–∫ 1",
        "ball_color": "red",
        "ball_points": 4,
        "total_score": 12,
        "position": 1
    }
}

{
    "type": "score_updated",
    "session_id": "session-uuid", 
    "game_id": "game-uuid",
    "timestamp": "2024-01-20T15:30:05Z",
    "data": {
        "scores": [
            {"player_id": "uuid1", "player_name": "–ò–≥—Ä–æ–∫ 1", "score": 12},
            {"player_id": "uuid2", "player_name": "–ò–≥—Ä–æ–∫ 2", "score": 8}
        ],
        "current_player_id": "uuid2"
    }
}
```

### Stats Events (`ws://api.domain.com/ws/stats/{user_id}`)

```json
{
    "type": "stats_updated",
    "user_id": "user-uuid",
    "timestamp": "2024-01-20T15:30:00Z",
    "data": {
        "total_games": 147,
        "total_wins": 89,
        "win_rate": 60.5,
        "total_earnings": 2350.50,
        "rank_change": +2,
        "new_achievements": ["first_win", "kolkhoz_master"]
    }
}
```

### Notification Events (`ws://api.domain.com/ws/notifications/{user_id}`)

```json
{
    "type": "notification_created",
    "user_id": "user-uuid", 
    "timestamp": "2024-01-20T15:30:00Z",
    "data": {
        "notification_id": "notif-uuid",
        "title": "–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∏–≥—Ä—É",
        "message": "–ò–≥—Ä–æ–∫ 1 –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –≤–∞—Å –≤ –∏–≥—Ä—É '–ö–æ–ª—Ö–æ–∑ –í–µ—á–µ—Ä–Ω–∏–π'",
        "category": "game_invitation",
        "action_url": "/sessions/session-uuid",
        "expires_at": "2024-01-20T16:30:00Z"
    }
}
```

## RabbitMQ Event Schemas

### Inter-Service Communication

```python
class GameCompletedEvent(BaseModel):
    """–°–æ–±—ã—Ç–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
    event_type: str = "game_completed"
    event_id: UUID = Field(default_factory=uuid4)
    timestamp: datetime = Field(default_factory=datetime.utcnow)
    source_service: str = "game_service"
    
    # Payload
    game_id: UUID
    session_id: UUID
    template_id: UUID
    participants: List[GameParticipantResult]
    duration_seconds: int
    game_number: int

class GameParticipantResult(BaseModel):
    user_id: UUID
    final_score: int
    balls_potted: int
    rubles_earned: Decimal
    rubles_paid: Decimal
    net_result: Decimal
    position: int  # 1=winner, 2=second, etc.

class StatsUpdateEvent(BaseModel):
    """–°–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    event_type: str = "stats_updated"
    event_id: UUID = Field(default_factory=uuid4)
    timestamp: datetime = Field(default_factory=datetime.utcnow)
    source_service: str = "stats_service"
    
    # Payload
    user_id: UUID
    stats_changes: dict
    new_achievements: List[str]
    rank_change: Optional[int]
```

## Error Codes Dictionary

```python
class APIErrorCodes:
    # General (1000-1999)
    VALIDATION_ERROR = "1001"
    AUTHENTICATION_ERROR = "1002"
    AUTHORIZATION_ERROR = "1003"
    NOT_FOUND = "1004"
    CONFLICT = "1005"
    RATE_LIMIT_EXCEEDED = "1006"
    
    # Auth Service (2000-2999)
    INVALID_TELEGRAM_SIGNATURE = "2001"
    USER_NOT_FOUND = "2002"
    TOKEN_EXPIRED = "2003"
    REFRESH_TOKEN_INVALID = "2004"
    
    # Game Service (3000-3999)
    SESSION_NOT_FOUND = "3001"
    SESSION_FULL = "3002"
    SESSION_ALREADY_STARTED = "3003"
    GAME_NOT_ACTIVE = "3004"
    INVALID_PLAYER_TURN = "3005"
    INVALID_GAME_EVENT = "3006"
    TEMPLATE_NOT_FOUND = "3007"
    INSUFFICIENT_PERMISSIONS = "3008"
    
    # Template Service (4000-4999)
    TEMPLATE_VALIDATION_ERROR = "4001"
    TEMPLATE_NOT_EDITABLE = "4002"
    CATEGORY_NOT_FOUND = "4003"
    
    # Stats Service (5000-5999)
    STATS_NOT_AVAILABLE = "5001"
    STATS_CALCULATION_ERROR = "5002"
    
    # Friends Service (6000-6999)
    FRIEND_REQUEST_EXISTS = "6001"
    ALREADY_FRIENDS = "6002"
    CANNOT_FRIEND_YOURSELF = "6003"
    FRIEND_REQUEST_NOT_FOUND = "6004"
    
    # Notification Service (7000-7999)
    NOTIFICATION_NOT_FOUND = "7001"
    PUSH_DELIVERY_FAILED = "7002"
```

üé®üé®üé® **EXITING CREATIVE PHASE: API DESIGN** üé®üé®üé®