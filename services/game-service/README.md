# Game Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–∞–º–∏ –∏ –∏–≥—Ä–æ–≤—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏ –¥–ª—è Artel Billiards.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üéÆ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏**: –°–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
- **–ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞**: –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π, –ø–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤
- **–°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π**: –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π –∏–≥—Ä–æ–∫–æ–≤
- **"–ö–æ–ª—Ö–æ–∑" –ª–æ–≥–∏–∫–∞**: –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑"
- **–†–µ–∞–ª-—Ç–∞–π–º —Å–æ–±—ã—Ç–∏—è**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### üéØ –¢–∏–ø—ã –∏–≥—Ä
- **Americana**: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞
- **Moscow Pyramid**: –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –ø–∏—Ä–∞–º–∏–¥–∞
- **Kolkhoz**: –ò–≥—Ä–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–∞—Å—á–µ—Ç–æ–≤

### üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ—á–µ—Ä–µ–¥–µ–π
- **Always Random**: –í—Å–µ–≥–¥–∞ —Å–ª—É—á–∞–π–Ω–∞—è –æ—á–µ—Ä–µ–¥—å
- **Random No Repeat**: –°–ª—É—á–∞–π–Ω–∞—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π
- **Manual**: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–µ—Ä–µ–¥–∏

## API Endpoints

### Sessions API (`/api/v1/sessions`)
```
POST   /sessions                    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
GET    /sessions                    # –°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET    /sessions/{id}               # –î–µ—Ç–∞–ª–∏ —Å–µ—Å—Å–∏–∏
POST   /sessions/{id}/join          # –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏
POST   /sessions/{id}/leave         # –ü–æ–∫–∏–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
POST   /sessions/{id}/invite        # –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
```

### Games API (`/api/v1/games`)
```
POST   /sessions/{id}/games         # –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
GET    /sessions/{id}/games         # –°–ø–∏—Å–æ–∫ –∏–≥—Ä —Å–µ—Å—Å–∏–∏
GET    /games/{id}                  # –î–µ—Ç–∞–ª–∏ –∏–≥—Ä—ã
POST   /games/{id}/events           # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
GET    /games/{id}/events           # –ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π
GET    /games/{id}/scores           # –¢–µ–∫—É—â–∏–µ —Å—á–µ—Ç–∞
POST   /games/{id}/end              # –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
```

### Health API
```
GET    /health                      # Health check
GET    /health/ready               # Readiness check
GET    /health/live                # Liveness check
```

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `game_types` - –¢–∏–ø—ã –∏–≥—Ä (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
- `game_sessions` - –ò–≥—Ä–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏
- `session_participants` - –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–µ—Å—Å–∏–π
- `games` - –û—Ç–¥–µ–ª—å–Ω—ã–µ –∏–≥—Ä—ã –≤ —Å–µ—Å—Å–∏–∏
- `game_events` - –°–æ–±—ã—Ç–∏—è –≤ –∏–≥—Ä–∞—Ö
- `game_results` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤ (–¥–ª—è "–ö–æ–ª—Ö–æ–∑")

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã
- **UUID** –¥–ª—è –≤—Å–µ—Ö primary keys
- **JSONB** –¥–ª—è –≥–∏–±–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –∏ –¥–∞–Ω–Ω—ã—Ö
- **–ò–Ω–¥–µ–∫—Å—ã** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Cascading deletes** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.13** - –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **FastAPI** - Web framework
- **PostgreSQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **SQLAlchemy** - ORM
- **Alembic** - –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- **Pydantic** - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **RabbitMQ** - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker
```bash
# –°–±–æ—Ä–∫–∞
docker build -t game-service .

# –ó–∞–ø—É—Å–∫
docker run -p 8002:8002 game-service
```

### Development
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫
uvicorn src.main:app --reload --port 8002
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
DATABASE_URL=postgresql://user:pass@host:5432/game_db
REDIS_URL=redis://redis:6379
RABBITMQ_URL=amqp://user:pass@rabbitmq:5672
JWT_SECRET_KEY=your-secret-key
SERVICE_PORT=8002
ENVIRONMENT=development
DEBUG=true
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –° –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **Auth Service**: –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
- **Template Service**: –ü–æ–ª—É—á–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –∏–≥—Ä –∏ –ø—Ä–∞–≤–∏–ª
- **API Gateway**: –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

### –°–æ–±—ã—Ç–∏—è RabbitMQ
- `game.session.created` - –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
- `game.session.joined` - –ò–≥—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è
- `game.game.started` - –ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞
- `game.event.occurred` - –ò–≥—Ä–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
- `game.game.ended` - –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ**:
- –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- API endpoints –¥–ª—è —Å–µ—Å—Å–∏–π –∏ –∏–≥—Ä
- –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã "–ö–æ–ª—Ö–æ–∑"
- –ê–ª–≥–æ—Ä–∏—Ç–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–µ–π
- Health checks

üöß **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ**:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Auth Service
- RabbitMQ —Å–æ–±—ã—Ç–∏—è
- Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- Unit —Ç–µ—Å—Ç—ã

üìã **–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è**:
- WebSocket –¥–ª—è —Ä–µ–∞–ª-—Ç–∞–π–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –°–∏—Å—Ç–µ–º–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã