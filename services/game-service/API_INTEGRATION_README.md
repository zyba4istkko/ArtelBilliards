# üéÆ API Integration - Game Service

## üìã –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å backend API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å—é –∏–≥—Ä–æ–∫–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º:
- **Always Random** - —Å–ª—É—á–∞–π–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã
- **Random No Repeat** - —Å–ª—É—á–∞–π–Ω–∞—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π (–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô)
- **Manual** - —Ä—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—á–µ—Ä–µ–¥–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (Game Service)

#### 1. –ê–ª–≥–æ—Ä–∏—Ç–º—ã –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ (`queue_algorithms.py`)
- `generate_always_random_queue()` - –ø—Ä–æ—Å—Ç–∞—è —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å
- `generate_random_no_repeat_queue()` - –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å –∏—Å—Ç–æ—Ä–∏–µ–π
- `generate_manual_queue()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫

#### 2. –ú–æ–¥–µ–ª–∏ –ë–î
- `Game` - –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–≥—Ä—ã –≤ —Å–µ—Å—Å–∏–∏
- `GameQueue` - –∏—Å—Ç–æ—Ä–∏—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è random_no_repeat)
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è `GameSession` —Å –ø–æ–ª–µ–º `current_game_id`

#### 3. API Endpoints
```
POST /api/v1/sessions/{session_id}/games - –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É
GET /api/v1/sessions/{session_id}/active-game - –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∏–≥—Ä—É
POST /api/v1/games/{game_id}/end - –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
```

### Frontend (React App)

#### 1. API Services
- `gameService.createGame()` - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
- `gameService.getActiveGame()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä—ã
- `gameService.completeGame()` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã

#### 2. ActiveGamePage Integration
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ Backend

```bash
cd services/game-service

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic upgrade head

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
uvicorn src.main:app --reload --port 8002
```

### 2. –ó–∞–ø—É—Å–∫ Frontend

```bash
cd react-app

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

#### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
```bash
curl -X POST "http://localhost:8002/api/v1/sessions/" \
  -H "Content-Type: application/json" \
  -d '{
    "game_type_id": 1,
    "name": "Test Session",
    "max_players": 4,
    "rules": {
      "point_value_rubles": 100,
      "queue_algorithm": "random_no_repeat"
    }
  }'
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
```bash
curl -X POST "http://localhost:8002/api/v1/sessions/{session_id}/games" \
  -H "Content-Type: application/json" \
  -d '{
    "queue_algorithm": "random_no_repeat"
  }'
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä—ã
```bash
curl "http://localhost:8002/api/v1/sessions/{session_id}/active-game"
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

```bash
cd services/game-service
python -m pytest tests/test_queue_algorithms.py -v
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
DATABASE_URL=postgresql://user:pass@host:5432/game_db
JWT_SECRET_KEY=your-secret-key
SERVICE_PORT=8002
ENVIRONMENT=development
DEBUG=true
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
- PostgreSQL 13+
- UUID –¥–ª—è primary keys
- JSONB –¥–ª—è –≥–∏–±–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üìä –õ–æ–≥–∏–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

### Always Random
- –ö–∞–∂–¥–∞—è –∏–≥—Ä–∞ = —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
- –ú–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Random No Repeat (–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô)
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º —Ü–∏–∫–ª–µ
- –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: N! –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–æ–∫ –¥–ª—è N –∏–≥—Ä–æ–∫–æ–≤

**–ü—Ä–∏–º–µ—Ä –¥–ª—è 3 –∏–≥—Ä–æ–∫–æ–≤:**
- –ò–≥—Ä–∞ 1: –ê‚Üí–ë‚Üí–í
- –ò–≥—Ä–∞ 2: –í‚Üí–ê‚Üí–ë (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—É 1)
- –ò–≥—Ä–∞ 3: –ë‚Üí–í‚Üí–ê (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-2)
- –ò–≥—Ä–∞ 4: –ê‚Üí–í‚Üí–ë (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-3)
- –ò–≥—Ä–∞ 5: –ë‚Üí–ê‚Üí–í (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-4)
- –ò–≥—Ä–∞ 6: –í‚Üí–ë‚Üí–ê (–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ò–≥—Ä—ã 1-5)
- –ò–≥—Ä–∞ 7: –ê‚Üí–ë‚Üí–í (—Å–±—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ - –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ 6 –∏–≥—Ä)

### Manual
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫
- Fallback –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –∏–≥—Ä—ã
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `game_events`
- API –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π (—à–∞—Ä—ã, —à—Ç—Ä–∞—Ñ—ã)
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 2. WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–∂–¥—É –∏–≥—Ä–æ–∫–∞–º–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö

### 3. –ü–æ–¥—Å—á–µ—Ç –æ—á–∫–æ–≤
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Å—á–µ—Ç–∞ –∏–∑ —Å–æ–±—ã—Ç–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API `/games/{id}/scores`
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å frontend

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- E2E —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ flow
- –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Linter –æ—à–∏–±–∫–∏** –≤ frontend - —Å–≤—è–∑–∞–Ω—ã —Å —Ç–∏–ø–∞–º–∏ NextUI
2. **Stub —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** –¥–ª—è —Å–æ–±—ã—Ç–∏–π –∏–≥—Ä—ã - —Ç—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
3. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –∑–∞–≥–ª—É—à–∫–∞, —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Auth Service

## üìù –õ–æ–≥–∏

### Backend
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
üéÆ Session {session_id}: –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É...

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ü–∏–∫–ª–∞ random_no_repeat
üîÑ Session {session_id}: –ó–∞–≤–µ—Ä—à–µ–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–∑ {N} –∏–≥—Ä. –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π —Ü–∏–∫–ª.
```

### Frontend
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
üéÆ –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∏–≥—Ä—É –≤ —Å–µ—Å—Å–∏–∏...
‚úÖ –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞: {game_data}
```

## ü§ù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

- **Auth Service** - JWT —Ç–æ–∫–µ–Ω—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **Session Service** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
- **Template Service** - –ø—Ä–∞–≤–∏–ª–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä
- **Notification Service** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2024-08-15
